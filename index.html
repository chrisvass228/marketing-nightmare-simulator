<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Nightmare Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.05) 10px,
                rgba(255, 255, 255, 0.05) 20px
            );
            animation: drift 20s linear infinite;
        }

        @keyframes drift {
            0% { transform: translateX(-50px) translateY(-50px); }
            100% { transform: translateX(50px) translateY(50px); }
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .scenario-selector {
            padding: 30px;
            background: white;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .scenario-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .scenario-card:hover::before {
            transform: scaleX(1);
        }

        .scenario-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .scenario-card h3 {
            color: #2c3e50;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .scenario-card p {
            color: #5a6c7d;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .scenario-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .difficulty {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .difficulty.nightmare {
            background: #ff6b6b;
            color: white;
        }

        .difficulty.crisis {
            background: #feca57;
            color: #2f3542;
        }

        .difficulty.chaos {
            background: #ff9ff3;
            color: #2f3542;
        }

        .personas {
            color: #667eea;
            font-weight: 600;
        }

        .chat-interface {
            display: none;
            height: 600px;
            background: white;
            flex-direction: column;
        }

        .chat-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            font-weight: 700;
            color: #2c3e50;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: linear-gradient(to bottom, #f8f9fa, white);
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
        }

        .avatar.ceo { background: #e74c3c; }
        .avatar.analyst { background: #3498db; }
        .avatar.agency { background: #9b59b6; }
        .avatar.user { background: #27ae60; }

        .message-content {
            max-width: 70%;
            padding: 15px 18px;
            border-radius: 18px;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message:not(.user) .message-content {
            background: white;
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            border-color: #667eea;
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            padding: 15px 18px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            margin-bottom: 20px;
            max-width: 70%;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #bbb;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(1);
            }
            30% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        .api-warning {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            color: #2d3436;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Marketing Nightmare Simulator</h1>
            <p>Experience realistic workplace disasters through AI-powered scenarios</p>
        </div>

        <div class="api-warning">
            ‚ö†Ô∏è Demo Mode: Add your Claude API key to enable full AI conversations (now with serverless backend!)
        </div>

        <div class="scenario-selector" id="scenarioSelector">
            <div class="scenario-grid">
                <div class="scenario-card" data-scenario="dashboard-doomsday">
                    <h3>üìä Dashboard Doomsday</h3>
                    <p>All marketing dashboards are broken 30 minutes before the board meeting. GA4 migration broke everything and you need conversion metrics NOW.</p>
                    <div class="scenario-meta">
                        <span class="difficulty nightmare">Nightmare</span>
                        <span class="personas">3 Personas</span>
                    </div>
                </div>

                <div class="scenario-card" data-scenario="typo-viral">
                    <h3>üî• The Typo That Went Viral</h3>
                    <p>Your social post has an autocorrect typo and is getting massive engagement for all the wrong reasons. 50K impressions and climbing with angry comments.</p>
                    <div class="scenario-meta">
                        <span class="difficulty crisis">Crisis</span>
                        <span class="personas">2 Personas</span>
                    </div>
                </div>

                <div class="scenario-card" data-scenario="wrong-url">
                    <h3>üîó Wrong URL Wednesday</h3>
                    <p>Your $50K campaign has been sending traffic to your competitor for 6 hours. The mistake was in the campaign setup and nobody noticed until now.</p>
                    <div class="scenario-meta">
                        <span class="difficulty nightmare">Nightmare</span>
                        <span class="personas">3 Personas</span>
                    </div>
                </div>

                <div class="scenario-card" data-scenario="budget-bomb">
                    <h3>üí£ Budget Bomb Crisis</h3>
                    <p>Your campaign overspent by 300% overnight due to a bidding error. Daily budget limits somehow got disabled and the money is gone.</p>
                    <div class="scenario-meta">
                        <span class="difficulty chaos">Chaos</span>
                        <span class="personas">3 Personas</span>
                    </div>
                </div>

                <div class="scenario-card" data-scenario="pixel-panic">
                    <h3>üì± Pixel Panic Emergency</h3>
                    <p>Facebook tracking has been broken for 2 weeks and nobody noticed. All your attribution data and recent marketing decisions are based on garbage data.</p>
                    <div class="scenario-meta">
                        <span class="difficulty crisis">Crisis</span>
                        <span class="personas">3 Personas</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-interface" id="chatInterface">
            <div class="chat-header">
                <div class="chat-title" id="chatTitle">Campaign Disaster Simulation</div>
                <button class="back-btn" onclick="showScenarios()">‚Üê Back to Scenarios</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
            <div class="chat-input">
                <div class="input-group">
                    <input type="text" id="messageInput" placeholder="Type your response..." maxlength="500">
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Scenario data with realistic personas and conversations
        const scenarios = {
            'dashboard-doomsday': {
                title: 'üìä Dashboard Doomsday Simulation',
                context: 'All marketing dashboards are broken 30 minutes before the board meeting. GA4 migration broke everything and you need conversion metrics NOW.',
                personas: {
                    ceo: {
                        name: 'Sarah Chen (CEO)',
                        avatar: 'SC',
                        personality: 'Urgent, demanding, but reasonable. Needs metrics for board meeting in 30 minutes.',
                        backstory: 'Former McKinsey consultant who built this company from scratch. Values transparency but hates surprises.'
                    },
                    analyst: {
                        name: 'Marcus Rodriguez (Data Analyst)',
                        avatar: 'MR', 
                        personality: 'Panicked but technical. Knows the GA4 migration broke everything. Mix of panic with technical explanations.',
                        backstory: 'Recently hired from a bigger company. Brilliant with data but overwhelmed by the crisis.'
                    },
                    agency: {
                        name: 'Alex Thompson (Agency Contact)',
                        avatar: 'AT',
                        personality: 'Trying to avoid blame while maintaining client relationship. Diplomatic but slightly defensive.',
                        backstory: 'Account manager who needs to keep this client happy. Walking the tightrope between blame and solutions.'
                    }
                }
            },
            'typo-viral': {
                title: 'üî• The Typo That Went Viral',
                context: 'Your social post has an autocorrect typo and is getting massive engagement for all the wrong reasons. 50K impressions and climbing.',
                personas: {
                    ceo: {
                        name: 'David Park (CEO)',
                        avatar: 'DP',
                        personality: 'Frustrated but solution-focused. Getting calls about the social media disaster.',
                        backstory: 'Former engineer who trusts processes. Learning that marketing can be unpredictably chaotic.'
                    },
                    agency: {
                        name: 'Jenny Wu (Social Media Manager)',
                        avatar: 'JW',
                        personality: 'Mortified but trying to fix it. Apologetic but solution-focused about the typo disaster.',
                        backstory: 'Perfectionist social media manager who just made a very public mistake.'
                    }
                }
            },
            'wrong-url': {
                title: 'üîó Wrong URL Wednesday',
                context: 'Your $50K campaign has been sending traffic to your competitor for the past 6 hours. The mistake was in the campaign setup.',
                personas: {
                    ceo: {
                        name: 'Lisa Martinez (CEO)',
                        avatar: 'LM',
                        personality: 'Incredulous and frustrated. Cannot believe the campaign is driving traffic to competitors.',
                        backstory: 'Results-driven CEO who expects quality control. This is her worst nightmare scenario.'
                    },
                    analyst: {
                        name: 'Tom Chen (Performance Analyst)',
                        avatar: 'TC', 
                        personality: 'Discovering the horrifying truth in the data. Technical but panicked about the implications.',
                        backstory: 'Detail-oriented analyst who just found the smoking gun in the traffic data.'
                    },
                    agency: {
                        name: 'Rachel Kim (Campaign Manager)',
                        avatar: 'RK',
                        personality: 'Responsible for the mistake. Defensive but trying to fix it quickly.',
                        backstory: 'Campaign manager who made the URL error. Trying to maintain credibility while fixing the disaster.'
                    }
                }
            },
            'budget-bomb': {
                title: 'üí£ Budget Bomb Crisis',
                context: 'Your campaign overspent by 300% overnight due to a bidding error. Daily budget limits somehow got disabled.',
                personas: {
                    ceo: {
                        name: 'Michael Torres (CEO)',
                        avatar: 'MT',
                        personality: 'Shocked about the overspend. Wants to understand how budget controls failed.',
                        backstory: 'Cost-conscious CEO who set strict budget controls for a reason. This breaks his trust in the system.'
                    },
                    analyst: {
                        name: 'Emma Davis (Data Analyst)',
                        avatar: 'ED', 
                        personality: 'Investigating the budget settings. Technical and methodical about finding the root cause.',
                        backstory: 'Analytical mind trying to piece together how the budget controls failed so catastrophically.'
                    },
                    agency: {
                        name: 'James Wilson (Account Director)',
                        avatar: 'JW',
                        personality: 'Trying to manage the crisis while investigating platform settings.',
                        backstory: 'Senior account director who needs to explain how professional campaign management failed.'
                    }
                }
            },
            'pixel-panic': {
                title: 'üì± Pixel Panic Emergency',
                context: 'Facebook tracking has been broken for 2 weeks and nobody noticed. Attribution data is completely unreliable.',
                personas: {
                    ceo: {
                        name: 'Ashley Brown (CEO)',
                        avatar: 'AB',
                        personality: 'Concerned about data integrity. Questions all recent marketing decisions based on bad data.',
                        backstory: 'Data-driven CEO who makes decisions based on metrics. Bad data means bad decisions.'
                    },
                    analyst: {
                        name: 'Kevin Park (Analytics Lead)',
                        avatar: 'KP', 
                        personality: 'Mortified about missing the tracking issues. Technical but embarrassed.',
                        backstory: 'Analytics lead who should have caught this. Questioning all his recent reports and recommendations.'
                    },
                    agency: {
                        name: 'Sophia Rodriguez (Digital Manager)',
                        avatar: 'SR',
                        personality: 'Explaining the technical complexity while trying to restore confidence.',
                        backstory: 'Digital manager who needs to fix tracking while maintaining client trust.'
                    }
                }
            }
        };

        // Demo responses for when API is not available
        const demoResponses = {
            ceo: [
                "I'm seeing some concerning numbers in the dashboard. Can you walk me through what exactly happened here?",
                "Look, I get that things go wrong, but I need to understand how we prevent this in the future.",
                "The board is asking questions. I need clear answers, not marketing jargon.",
                "What's our action plan? And please tell me we have backup strategies.",
                "This is exactly why I wanted multiple checkpoints in our processes."
            ],
            analyst: [
                "The data is... well, it's not great. Let me pull up the exact numbers for you.",
                "I've been digging into the metrics and I think I found part of the issue.",
                "Based on the cohort analysis, we might be looking at a bigger problem than initially thought.",
                "I can build a model to predict the impact, but I'll need a few hours to get it right.",
                "Let me check with the dev team about the tracking issues... this is exactly what we were worried about."
            ],
            agency: [
                "Hey team, I've been monitoring the situation closely and I have some thoughts on next steps.",
                "We've seen this type of scenario with other clients. Here's what typically works...",
                "I'm going to be honest - this is challenging, but not insurmountable. We have options.",
                "Let me reach out to my contacts at the platforms. Sometimes there are solutions that aren't public knowledge.",
                "I'm escalating this to our senior team. We need all hands on deck for damage control."
            ]
        };

        let currentScenario = null;
        let conversationHistory = [];
        let currentPersona = 'ceo';
        let messageCount = 0;
        let apiKey = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // Scenario card clicks
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.addEventListener('click', function() {
                    const scenarioId = this.dataset.scenario;
                    startScenario(scenarioId);
                });
            });

            // Enter key in input - only add if element exists
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
        }

        function startScenario(scenarioId) {
            if (!scenarios[scenarioId]) return;
            
            currentScenario = scenarios[scenarioId];
            conversationHistory = [];
            messageCount = 0;
            
            // Check for API key
            const apiInput = prompt("Enter your Claude API key (optional - leave blank for demo mode):\n\nGet your key at: console.anthropic.com");
            if (apiInput && apiInput.trim()) {
                apiKey = apiInput.trim();
            }
            
            document.getElementById('scenarioSelector').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'flex';
            document.getElementById('chatTitle').textContent = currentScenario.title;
            
            // Clear previous messages
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '<div class="typing-indicator" id="typingIndicator"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
            
            // Start with initial message from appropriate persona
            const scenarioKey = Object.keys(scenarios).find(key => scenarios[key] === currentScenario);
            const initialPersona = getInitialPersona(scenarioKey);
            currentPersona = initialPersona;
            
            setTimeout(() => {
                addMessage(currentPersona, getInitialMessage(), currentPersona);
            }, 1000);
        }

        function getInitialPersona(scenarioKey) {
            const initialPersonas = {
                'dashboard-doomsday': 'ceo',
                'typo-viral': 'agency',
                'wrong-url': 'analyst',
                'budget-bomb': 'ceo',
                'pixel-panic': 'analyst'
            };
            return initialPersonas[scenarioKey] || 'ceo';
        }

        function getInitialMessage() {
            const messages = {
                'dashboard-doomsday': {
                    ceo: "üö® URGENT: Need Q4 conversion numbers for board meeting in 30 minutes. Where are we on performance vs targets?"
                },
                'typo-viral': {
                    agency: "Code red. Our morning post about 'customer satisfaction' autocorrected to... something inappropriate. It's at 50K impressions and climbing. Comments are... not good."
                },
                'wrong-url': {
                    analyst: "Wait... I'm looking at our traffic data and something is very wrong. Our campaign traffic is going to... oh no... it's going to our competitor's site."
                },
                'budget-bomb': {
                    ceo: "I just got an alert that we spent $150K overnight on Facebook ads. Our daily budget was supposed to be $500. What the hell happened?"
                },
                'pixel-panic': {
                    analyst: "I've been auditing our tracking setup and... this is bad. Our Facebook pixel hasn't been firing properly for TWO WEEKS. All our recent data is garbage."
                }
            };
            
            const scenarioKey = Object.keys(scenarios).find(key => scenarios[key] === currentScenario);
            const persona = getInitialPersona(scenarioKey);
            return messages[scenarioKey]?.[persona] || "We need to talk about the current situation.";
        }

        function addMessage(sender, content, avatarKey) {
            const messagesContainer = document.getElementById('chatMessages');
            const typingIndicator = document.getElementById('typingIndicator');
            
            if (!messagesContainer) {
                console.error('Messages container not found');
                return;
            }
            
            // Hide typing indicator
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'user' ? 'user' : ''}`;
            
            const avatar = document.createElement('div');
            avatar.className = `avatar ${avatarKey}`;
            avatar.textContent = sender === 'user' ? 'You' : (currentScenario.personas[avatarKey]?.avatar || avatarKey.toUpperCase());
            
            const content_div = document.createElement('div');
            content_div.className = 'message-content';
            content_div.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content_div);
            
            if (typingIndicator) {
                messagesContainer.insertBefore(messageDiv, typingIndicator);
            } else {
                messagesContainer.appendChild(messageDiv);
            }
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Add to conversation history
            conversationHistory.push({
                sender: sender,
                content: content,
                persona: avatarKey
            });
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            
            if (!input || !sendBtn) {
                console.error('Input elements not found');
                return;
            }
            
            const message = input.value.trim();
            
            if (!message) return;
            
            // Disable input temporarily
            sendBtn.disabled = true;
            input.disabled = true;
            
            // Add user message
            addMessage('user', message, 'user');
            input.value = '';
            
            // Show typing indicator
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.style.display = 'block';
            }
            
            // Get AI response after delay
            setTimeout(async () => {
                try {
                    let response;
                    if (apiKey) {
                        response = await getAIResponse(message);
                    } else {
                        response = getDemoResponse();
                    }
                    
                    // Add AI response
                    addMessage('ai', response.content, response.persona);
                    
                    // Switch persona for next response
                    switchPersona();
                    
                } catch (error) {
                    console.error('Error getting response:', error);
                    addMessage('ai', 'Sorry, there was an error getting a response. Please try again.', currentPersona);
                }
                
                // Re-enable input
                sendBtn.disabled = false;
                input.disabled = false;
                input.focus();
            }, 2000 + Math.random() * 2000);
        }

        async function getAIResponse(userMessage) {
            const scenarioKey = Object.keys(scenarios).find(key => scenarios[key] === currentScenario);
            const persona = currentScenario.personas[currentPersona];
            
            try {
                // Call our Netlify function instead of Claude directly
                const response = await fetch('/.netlify/functions/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: userMessage,
                        persona: persona,
                        scenario: currentScenario,
                        apiKey: apiKey
                    })
                });

                console.log('Function Response Status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`Function request failed: ${response.status}`);
                }

                const data = await response.json();
                console.log('Function Response Data:', data);
                
                if (data.success) {
                    return {
                        content: data.content,
                        persona: currentPersona
                    };
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Function API Error:', error);
                console.log('Falling back to demo responses');
                // Fallback to demo response on API error
                return getDemoResponse();
            }
        }

        function getDemoResponse() {
            const responses = demoResponses[currentPersona];
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            messageCount++;
            
            return {
                content: randomResponse,
                persona: currentPersona
            };
        }

        function switchPersona() {
            const personas = Object.keys(currentScenario.personas);
            const currentIndex = personas.indexOf(currentPersona);
            const nextIndex = (currentIndex + 1) % personas.length;
            currentPersona = personas[nextIndex];
        }

        function showScenarios() {
            document.getElementById('chatInterface').style.display = 'none';
            document.getElementById('scenarioSelector').style.display = 'block';
            currentScenario = null;
            conversationHistory = [];
        }

        // Add some dynamic visual effects
        function addVisualEffects() {
            // Floating particles effect for header
            const header = document.querySelector('.header');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: rgba(255,255,255,0.3);
                    border-radius: 50%;
                    top: ${Math.random() * 100}%;
                    left: ${Math.random() * 100}%;
                    animation: float ${3 + Math.random() * 4}s ease-in-out infinite;
                    animation-delay: ${Math.random() * 2}s;
                `;
                header.appendChild(particle);
            }
        }

        // Add CSS for particle animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0; }
                50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
            }
        `;
        document.head.appendChild(style);

        // Initialize visual effects
        setTimeout(addVisualEffects, 1000);
    </script>
</body>
</html>